sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast"],(e,t)=>{"use strict";return e.extend("project1.controller.cameraimage",{stream:null,onInit(){},onOpenCamera:function(){const e=this;if(e.stream){e._stopCameraStream()}if(!e.cameraFacingMode||e.cameraFacingMode==="user"){e.cameraFacingMode="environment"}else{e.cameraFacingMode="user"}const o={video:{facingMode:{ideal:e.cameraFacingMode},width:{ideal:1280},height:{ideal:720}}};if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){navigator.mediaDevices.getUserMedia(o).then(function(t){e.stream=t;e.getView().byId("videoContainer").setContent(`<video id="liveVideo" autoplay playsinline style="width: 85%; height: 85%;"></video>`);setTimeout(()=>{const o=document.getElementById("liveVideo");if(o){o.srcObject=t;e.getView().byId("captureButton").setVisible(true);e.getView().byId("toggleCameraButton").setVisible(true)}},500)}).catch(function(e){console.error("Camera error:",e);t.show("Camera access denied or unavailable.")})}else{t.show("Camera not supported on this device.")}},onCaptureImage:function(){const e=this;const o=document.getElementById("liveVideo");if(!o){t.show("Camera is not active.");return}const a=document.createElement("canvas");a.width=540;a.height=480;const n=a.getContext("2d");n.drawImage(o,0,0,a.width,a.height);const s=a.toDataURL("image/png");e._stopCameraStream();e.getView().byId("videoContainer").setContent("");const i=e.getView().byId("capturedImage");i.setSrc(s);i.setVisible(true);t.show("Image captured successfully!");this.onRecognizePlate();console.log("Base64 Image Data:",s)},_stopCameraStream:function(){if(this.stream){this.stream.getTracks().forEach(e=>e.stop());this.stream=null}},onRecognizePlate:function(){const e=this.byId("capturedImage").getSrc();if(!e){t.show("No image captured.");return}sap.ui.core.BusyIndicator.show(0);const o="https://api.platerecognizer.com/v1/plate-reader/";const a="655598879ee69682f41181fd0f3e1ed663195c5b";function n(e){const t=atob(e.split(",")[1]);const o=new Array(t.length);for(let e=0;e<t.length;e++){o[e]=t.charCodeAt(e)}const a=new Uint8Array(o);return new Blob([a],{type:"image/png"})}const s=n(e);const i=new FormData;i.append("upload",s,"captured_plate.png");i.append("regions","ae-du");fetch(o,{method:"POST",headers:{Authorization:`Token ${a}`},body:i}).then(e=>e.json()).then(e=>{if(e.results&&e.results.length>0){const a=e.results[0].plate.toUpperCase();if(e.results[0].color.length>0){const t=e.results[0].color.reduce((e,t)=>t.score>e.score?t:e);this.byId("plateColor").setValue(t.color)}else{this.byId("plateColor").setValue("No Color Fetch")}const n=e.results[0].region;this.byId("plateNum").setValue(a);this.byId("plateRegion").setValue(n.code.toUpperCase());sap.ui.core.BusyIndicator.hide();t.show("Number plate recognized successfully!");var o=this.getView().byId("cameraPage");if(o){o.getScrollDelegate().scrollTo(0,0,500)}}else{sap.ui.core.BusyIndicator.hide();this.byId("plateNum").setValue("No plate detected.");t.show("Failed to recognize number plate.")}}).catch(e=>{console.error("OCR Error: ",e);t.show("Failed to recognize number plate.")})},backToLanding:function(){const e=this.getOwnerComponent().getRouter();e.navTo("RouteLanding",{},true)}})});
//# sourceMappingURL=cameraimage.controller.js.map