sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast"],(e,t)=>{"use strict";return e.extend("project1.controller.cameraimage",{stream:null,onInit(){},onOpenCamera:function(){const e=this;if(e.stream){e._stopCameraStream()}if(!e.cameraFacingMode||e.cameraFacingMode==="user"){e.cameraFacingMode="environment"}else{e.cameraFacingMode="user"}const a={video:{facingMode:{ideal:e.cameraFacingMode},width:{ideal:1280},height:{ideal:720}}};if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){navigator.mediaDevices.getUserMedia(a).then(function(t){e.stream=t;e.getView().byId("videoContainer").setContent(`<video id="liveVideo" autoplay playsinline style="width: 85%; height: 85%;"></video>`);setTimeout(()=>{const a=document.getElementById("liveVideo");if(a){a.srcObject=t;e.getView().byId("captureButton").setVisible(true);e.getView().byId("toggleCameraButton").setVisible(true)}},500)}).catch(function(e){console.error("Camera error:",e);t.show("Camera access denied or unavailable.")})}else{t.show("Camera not supported on this device.")}},onCaptureImage:function(){const e=this;const a=document.getElementById("liveVideo");if(!a){t.show("Camera is not active.");return}const o=document.createElement("canvas");o.width=540;o.height=480;const n=o.getContext("2d");n.drawImage(a,0,0,o.width,o.height);const i=o.toDataURL("image/png");e._stopCameraStream();e.getView().byId("videoContainer").setContent("");const s=e.getView().byId("capturedImage");s.setSrc(i);s.setVisible(true);t.show("Image captured successfully!");this.onRecognizePlate();console.log("Base64 Image Data:",i)},_stopCameraStream:function(){if(this.stream){this.stream.getTracks().forEach(e=>e.stop());this.stream=null}},onRecognizePlate:function(){const e=this.byId("capturedImage").getSrc();if(!e){t.show("No image captured.");return}sap.ui.core.BusyIndicator.show(0);const a="https://api.platerecognizer.com/v1/plate-reader/";const o="655598879ee69682f41181fd0f3e1ed663195c5b";function n(e){const t=atob(e.split(",")[1]);const a=new Array(t.length);for(let e=0;e<t.length;e++){a[e]=t.charCodeAt(e)}const o=new Uint8Array(a);return new Blob([o],{type:"image/png"})}const i=n(e);const s=new FormData;s.append("upload",i,"captured_plate.png");s.append("regions","ae-du");fetch(a,{method:"POST",headers:{Authorization:`Token ${o}`},body:s}).then(e=>e.json()).then(e=>{if(e.results&&e.results.length>0){const a=e.results[0].plate.toUpperCase();const o="Plate No : "+a;this.byId("recognizedText").setValue(o);sap.ui.core.BusyIndicator.hide();t.show("Number plate recognized successfully!")}else{sap.ui.core.BusyIndicator.hide();this.byId("recognizedText").setValue("No plate detected.");t.show("Failed to recognize number plate.")}}).catch(e=>{console.error("OCR Error: ",e);t.show("Failed to recognize number plate.")})}})});
//# sourceMappingURL=cameraimage.controller.js.map